// src/services/aiPrompt.ts
import type { Student } from "../types/student";

export function buildStudentRiskPrompt(
  student: Student,
  lang: "kk" | "ru"
): string {
  const baseInfo = `
Оқушы туралы деректер:
- Аты-жөні: ${student.fullName}
- Сыныбы: ${student.className}
- Жынысы: ${student.gender === "male" ? "ұл" : "қыз"}

Академиялық жағдай:
- Жалпы орташа баға: ${student.avgGrade} / 5.0
- Үлгерім тренді (теріс болса – нашарлау): ${student.gradeTrend}

Қатысу:
- Барлық келмеген күндер: ${student.absences}
- Себепсіз келмеген күндер: ${student.unexcusedAbsences}

Тәртіп және қатысу:
- Үй тапсырмаларын орындау пайызы: ${student.homeworkCompletion}%
- Мұғалім ескертулері: ${student.teacherAlerts}
- Сабақтағы белсенділік: ${
    student.lowActivity ? "төмен" : "қалыпты немесе жоғары"
  }

Пәндер бойынша тәуекелдер:
- Қиын пәндер: ${
    student.subjectsAtRisk?.length ? student.subjectsAtRisk.join(", ") : "жоқ"
  }
`;

  if (lang === "kk") {
    return (
      baseInfo +
      `

МІНДЕТ:
Осы деректер негізінде тәуекел факторларын, психологиялық сигналдарды және әр рөлге арналған (мұғалім, завуч, ата-ана, психолог) нақты, қысқа кеңестерді анықта.

Нәтижені тек JSON форматында бер. Құрылымы:
{
  "reasons": [ "тәуекел себептері (қысқа сөйлемдер)", ... ],
  "psychSignals": [ "психологиялық сигналдар (тәуекел индикаторлары)", ... ],
  "roleRecs": {
    "teacher": [ "мұғалімге арналған кеңестер", ... ],
    "deputy": [ "завучқа арналған кеңестер", ... ],
    "parent": [ "ата-анаға арналған кеңестер", ... ],
    "psychologist": [ "психологқа арналған кеңестер", ... ]
  }
}

Талаптар:
- Барлық мәтінді қазақ тілінде жаз.
- Әр элемент – 1 қысқа, нақты ой, практикалық қадам.
- Оқушыға зиян келтіретін, стигматизациялайтын сөздер қолданба.
- Ешқандай түсіндірме мәтін, комментарий, Markdown, "JSON:" деген сияқты сөздер жазба.
- Тек таза JSON-object қайтар.`
    );
  }

  // ru
  return (
    baseInfo +
    `

ЗАДАЧА:
На основе этих данных определи основные причины риска, возможные психологические сигналы и дай практичные рекомендации для каждой роли (учитель, завуч, родитель, психолог).

Верни ТОЛЬКО JSON следующей структуры:
{
  "reasons": [ "краткие причины риска", ... ],
  "psychSignals": [ "психологические сигналы / индикаторы", ... ],
  "roleRecs": {
    "teacher": [ "совет учителю", ... ],
    "deputy": [ "совет завучу", ... ],
    "parent": [ "совет родителям", ... ],
    "psychologist": [ "совет психологу", ... ]
  }
}

Требования:
- Все строки пиши на русском языке.
- Каждый элемент массива — 1 короткий, очень конкретный совет или формулировка.
- Не используй стигматизирующие или оскорбительные формулировки.
- Не добавляй пояснений, комментариев, Markdown, \`json\` и т.п.
- Верни только чистый JSON-объект.`
  );
}
